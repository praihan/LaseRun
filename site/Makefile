include Makefile.inc
include SOURCES.inc

BUILD_DIR :=build
CP_FILES :=assets lib
INDEX_FILENAME :=index.html
OUTPUT_FILE_NAME :=build.js
JSC_BASE_DIR :=$(PROJECT_ROOT)/$(TOOLS_JSCOMPILER)

JSC =$(JAVA_JAR) $(JSC_BASE_DIR)/$(TOOLS_JSCOMPILER_FILENAME)

JSC_FLAGS :=--language_in ECMASCRIPT5

all: build

build: 
	$(MKDIR) -p $(BUILD_DIR)
	$(CP) -r -f $(CP_FILES) $(BUILD_DIR)/
	$(JSC) $(JSC_FLAGS) $(TOOLS_JSCOMPILER_FLAG_INPUT) $(INPUT_FILES) $(TOOLS_JSCOMPILER_FLAG_OUTPUT) $(BUILD_DIR)/$(OUTPUT_FILE_NAME)
	$(JAVA_JAR) $(PROJECT_ROOT)/$(TOOLS_HTMINJECT)/$(TOOLS_HTMINJECT_FILENAME) $(INDEX_FILENAME) $(BUILD_DIR)/$(INDEX_FILENAME) $(OUTPUT_FILE_NAME)

clean:
	$(RM) -rf $(BUILD_DIR)

.PHONY : $(INPUT_FILES) build all clean